<!DOCTYPE html>
<html lang="fr"
      xmlns:th="http://www.thymeleaf.org">

<head>
    <title>État de Stock</title>
    <th:block th:insert="~{fragment/load_css :: load_css}"></th:block>
    <th:block th:insert="~{fragment/font :: font}"></th:block>
    <th:block th:insert="~{fragment/load_script :: load_script}"></th:block>
</head>

<body>
    <div th:replace="~{fragment/sidebar :: sidebar}"></div>
    <div class="main-content">
        <section>

            <!-- En-tête -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="fw-bold">
                    <i class="fas fa-warehouse me-3 icon-gradient-blue"></i> État de Stock
                </h1>

                <a th:href="@{/admin}" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-box me-3"></i> Liste des Articles
                </a>
            </div>

            <!-- Carte contenant le tableau -->
            <div class="card shadow-lg border-0">
                <div class="card-body">

                    <div class="table-responsive">
                        <table id="etatStockTable" class="table table-striped table-hover">
                            <thead>

                            <tr>
                                <th><i class="fas fa-box me-2 icon-gradient-blue"></i>Article</th>
                                <th><i class="fas fa-exclamation-triangle me-2 icon-gradient-blue"></i>Seuil minimum</th>
                                <th><i class="fas fa-sign-in-alt me-2 icon-gradient-blue"></i>Entrée</th>
                                <th><i class="fas fa-sign-out-alt me-2 icon-gradient-blue"></i>Sortie</th>
                                <th><i class="fas fa-chart-pie me-2 icon-gradient-blue"></i>Stock Disponible</th>
                            </tr>

                            </thead>

                            <tbody>
                            <tr th:each="e : ${etatStocks}">
                                <td>
                                    <strong th:text="${e.codeArticle}"></strong><br>
                                    <small class="text-muted" th:text="${e.designation}"></small>
                                </td>
                                <td th:text="${e.seuilMin}"></td>
                                <td><span class="badge bg-success" th:text="${e.totalEntree}"></span></td>
                                <td><span class="badge bg-danger" th:text="${e.totalSortie}"></span></td>
                                <td>
                                    <span th:text="${e.stockDisponible}">
                                    </span>
                                </td>
                            </tr>
                            </tbody>
                        </table>

                    </div>

                </div>
            </div>

        </section>
    </div>
    <script th:inline="none">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', function() {
            const table = $('#etatStockTable').DataTable({
                language: {
                    zeroRecords: "Aucun résultat trouvé",
                    search: "Rechercher:",
                    lengthMenu: "Afficher _MENU_",
                    info: "Affichage de _START_ à _END_ sur _TOTAL_ lignes",
                    infoEmpty: "Aucune donnée disponible",
                    paginate: {
                        first: "Première",
                        last: "Dernière",
                        next: "Suivante",
                        previous: "Précédente"
                    }
                },
                pageLength: 10,
                lengthMenu: [[10, 25, 50, 100], [10, 25, 50, 100]],
                responsive: true,
                dom: '<"row"<"col-md-6"l><"col-md-6">><"row"<"col-12"tr>><"row"<"col-md-5"i><"col-md-7"p>>',

                initComplete: function () {
                    const api = this.api();

                    // Clonage de la ligne d'entête pour les filtres
                    $('#etatStockTable thead tr').clone(true).appendTo('#etatStockTable thead');

                    $('#etatStockTable thead tr:eq(1) th').each(function (i) {
                        if (i < 5) {
                            $(this).html('<input class="form-control form-control-sm" type="text" placeholder="Filtrer..." />');
                            $('input', this).on('keyup change', function () {
                                if (api.column(i).search() !== this.value) {
                                    api.column(i).search(this.value).draw();
                                }
                            });
                        }
                    });

                    // ✅ Recherche mobile
                    $('<div class="mobile-search-container mb-3">' +
                        '<div class="input-group">' +
                        '<span class="input-group-text"><i class="fas fa-search"></i></span>' +
                        '<input type="text" class="form-control" id="mobileSearchStock" placeholder="Rechercher dans le stock...">' +
                        '</div>' +
                        '</div>').insertBefore('#etatStockTable');

                    $('#mobileSearchStock').on('keyup', function() {
                        api.search(this.value).draw();
                    });

                    function toggleMobileSearch() {
                        if ($(window).width() <= 768) {
                            $('.mobile-search-container').show();
                            $('#etatStockTable thead tr:eq(1)').hide();
                            $('.dataTables_filter').hide();
                        } else {
                            $('.mobile-search-container').hide();
                            $('#etatStockTable thead tr:eq(1)').show();
                            $('.dataTables_filter').show();
                        }
                    }

                    toggleMobileSearch();
                    $(window).on('resize', toggleMobileSearch);
                }
            });
        });

        /*]]>*/
    </script>
</body>
</html>
